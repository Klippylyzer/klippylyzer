{"mappings":"oeAAA,IAAAA,EAAAC,EAAA,S,0BASe,SAAAC,EAAkBC,G,IAAAC,EAAAD,EAAEC,UACjC,OACEJ,EAAAK,KAAC,MAAG,CAACC,UAAWC,EAAAC,EAAA,G,UACdR,EAAAS,IAAC,KAAE,C,SAAC,qBACHL,EAAUM,MAAMC,OAAOC,iBAAiB,iBACzCZ,EAAAS,IAAC,KAAE,C,SAAC,yBACHI,KAAKC,UAAUC,EAAAC,mCAAmCZ,W,2GCfzD,IAAAa,EAAAhB,EAAA,S,aAwBO,SAASiB,EAAmCC,GACjD,IACMC,EAvBR,SAAkCC,GAChC,IAAMD,EAAoB,GAEtBE,EAAwB,GACvBC,GAAW,EAAXC,GAAW,EAAXC,OAAWC,E,IAAhB,I,IAAKC,E,gBAAA,IAAMC,EAAND,EAAWE,MACdP,EAAeA,EAAaQ,MAAM,EAAG,GAAGC,OAAOH,GAC/C,IAAMI,EAAiB,GAEvBV,EAAaW,SAAQ,SAACC,G,OACpBC,OAAOC,QAAQF,GAAOD,SAAQ,SAAA9B,G,2BAAEkC,EAAGC,EAAA,GAAET,EAAKS,EAAA,GACxCN,EAAQK,IAAQL,EAAQK,IAAQ,GAAKR,QAIzCT,EAASmB,KACPJ,OAAOK,YAAYL,OAAOC,QAAQJ,GAASS,KAAI,SAAAtC,G,iCAAkB,CAAbmC,EAAA,GAAOA,EAAA,GAAoBhB,EAAaX,cAX3F+B,EAAerB,EAAQsB,OAAAC,cAAvBrB,GAAAI,EAAAe,EAAWG,QAAAC,MAAXvB,GAAW,EAAAwB,EAAAL,EAAAf,G,SAAXH,GAAW,EAAXC,EAAWuB,E,YAAXzB,GAAW,MAAXmB,EAAWO,QAAXP,EAAWO,S,WAAXzB,E,MAAAC,GAeL,OAAOL,EAIU8B,CADAC,EAAAC,aAAajC,EAAIT,QAG5B2C,EAAY,GACdC,EAAclC,EAAS,GACtBG,GAAa,EAAbC,GAAa,EAAbC,OAAaC,E,IAAlB,QAAKC,EAAAe,EAAiBtB,EAASU,MAAM,GAAEa,OAAAC,cAAlCrB,GAAAI,EAAAe,EAAaG,QAAAC,MAAbvB,GAAa,EAAuB,CAApC,IAAMS,EAANL,EAAaE,MACX0B,GAAkB,EAAlBC,GAAkB,EAAlBC,OAAkB/B,E,IAAvB,QAAKgC,EAAAC,EAAsBxB,OAAOC,QAAQJ,GAAQW,OAAAC,cAA7CW,GAAAG,EAAAC,EAAkBd,QAAAC,MAAlBS,GAAkB,GAAlB,IAAAK,EAAA3C,EAAA4C,cAAAH,EAAkB7B,MAAA,GAAXQ,EAAGuB,EAAA,GAAE/B,EAAK+B,EAAA,GAChBN,EAAYjB,GAAO,GAAKR,EAA2B,IAAnByB,EAAYjB,IAC9CgB,EAAUd,KAAK,CACbuB,KAAM9B,EAAQ8B,KACdC,KAAM1B,EACN2B,gBAAiBV,EAAYjB,GAC7BR,W,SAND2B,GAAkB,EAAlBC,EAAkBT,E,YAAlBO,GAAkB,MAAlBI,EAAkBV,QAAlBU,EAAkBV,S,WAAlBO,E,MAAAC,GAULH,EAActB,G,SAXXR,GAAa,EAAbC,EAAauB,E,YAAbzB,GAAa,MAAbmB,EAAaO,QAAbP,EAAaO,S,WAAbzB,E,MAAAC,GAcL,OAAO4B,M","sources":["src/Routes/KlippyLog/Analysis.tsx","src/utils/analysis.ts"],"sourcesContent":["import cx from \"ts-classnames\";\r\n\r\nimport { KlippyLog } from \"../../types\";\r\nimport { searchForAbnormalTemperatureSpikes } from \"../../utils/analysis\";\r\n\r\ninterface Props {\r\n  klippyLog: KlippyLog;\r\n}\r\n\r\nexport default function Analysis({ klippyLog }: Props) {\r\n  return (\r\n    <div className={cx()}>\r\n      <h2>General Analysis</h2>\r\n      {klippyLog.stats.length.toLocaleString()} stats entries\r\n      <h2>Temperature Analysis</h2>\r\n      {JSON.stringify(searchForAbnormalTemperatureSpikes(klippyLog))}\r\n    </div>\r\n  );\r\n}\r\n","import { KlippyLog, Temps } from \"../types\";\r\nimport { statsToTemps } from \".\";\r\n\r\nfunction calculateRunningAverages(allTemps: Temps[]) {\r\n  const averages: Temps[] = [];\r\n\r\n  let runningTemps: Temps[] = [];\r\n  for (const temps of allTemps) {\r\n    runningTemps = runningTemps.slice(1, 5).concat(temps);\r\n    const average: Temps = {};\r\n\r\n    runningTemps.forEach((temps) =>\r\n      Object.entries(temps).forEach(([key, value]) => {\r\n        average[key] = (average[key] || 0) + value;\r\n      })\r\n    );\r\n\r\n    averages.push(\r\n      Object.fromEntries(Object.entries(average).map(([key, value]) => [key, value / runningTemps.length]))\r\n    );\r\n  }\r\n\r\n  return averages;\r\n}\r\nexport function searchForAbnormalTemperatureSpikes(log: KlippyLog) {\r\n  const allTemps = statsToTemps(log.stats);\r\n  const averages = calculateRunningAverages(allTemps);\r\n\r\n  const anomalies = [];\r\n  let lastAverage = averages[0];\r\n  for (const average of averages.slice(1)) {\r\n    for (const [key, value] of Object.entries(average)) {\r\n      if (lastAverage[key] > 0 && value > lastAverage[key] * 1.2) {\r\n        anomalies.push({\r\n          time: average.time,\r\n          name: key,\r\n          previousAverage: lastAverage[key],\r\n          value,\r\n        });\r\n      }\r\n    }\r\n    lastAverage = average;\r\n  }\r\n\r\n  return anomalies;\r\n}\r\n"],"names":["$lBpE3","parcelRequire","$8992991614eaf5e4$export$2e2bcd8739ae039","param","klippyLog","jsxs","className","$parcel$interopDefault","$kOpwP","jsx","stats","length","toLocaleString","JSON","stringify","$cpdFe","searchForAbnormalTemperatureSpikes","$5Sbbl","$4eff554259264e8b$export$948a1c9e364f20e5","log","averages","allTemps","runningTemps","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","temps1","value","slice","concat","average","forEach","temps","Object","entries","key","_param","push","fromEntries","map","_iterator","Symbol","iterator","next","done","_loop","err","return","$4eff554259264e8b$var$calculateRunningAverages","$dHI7O","statsToTemps","anomalies","lastAverage","_iteratorNormalCompletion1","_didIteratorError1","_iteratorError1","_step1","_iterator1","_value","slicedToArray","time","name","previousAverage"],"version":3,"file":"Analysis.cf3876c6.js.map"}