{"version":3,"file":"Backup.5a3d20b0.js","sources":["../../src/Routes/Backups/Backup.tsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\nimport { NavLink, Outlet, useParams } from \"react-router-dom\";\n\nimport useDb, { Backup as BackupType, BackupFile as BackupFileType } from \"../../Context/Database\";\nimport { humanSize } from \"../../utils\";\nimport cx from \"../../utils/cx\";\n\nexport default function Backup() {\n  const { backupId } = useParams<{ backupId: string }>();\n  const db = useDb();\n\n  const [backup, setBackup] = useState<undefined | BackupType>();\n  const [backupFiles, setBackupFiles] = useState<Array<BackupFileType>>([]);\n\n  useEffect(\n    function () {\n      if (!backupId) return undefined;\n\n      db.get(\"backup\", parseInt(backupId)).then((backup) => setBackup(backup as BackupType));\n    },\n    [backupId, db]\n  );\n\n  useEffect(\n    function () {\n      if (!backup) return;\n\n      const backupFileIds = backup.files.map((file) => file.id) as number[];\n\n      db.getAllFromIndex(\n        \"backupFile\",\n        \"by-id\",\n        IDBKeyRange.bound(Math.min(...backupFileIds), Math.max(...backupFileIds))\n      ).then((files) =>\n        setBackupFiles(\n          files.filter(\n            (backupFile) => backup.files.map(({ id }) => id).indexOf(backupFile.id as number) !== -1\n          ) as Array<BackupFileType>\n        )\n      );\n    },\n    [backup, db]\n  );\n\n  if (backup) {\n    return (\n      <div>\n        <h3 className={cx(\"text-lg\", \"breadcrumbs\")}>\n          <ul>\n            <li>\n              <NavLink to=\"/moonraker/backups\" className={cx(\"text-gray-600\", \"dark:text-gray-400\")}>\n                Backups\n              </NavLink>\n            </li>\n            <li>{backup.name}</li>\n          </ul>\n        </h3>\n\n        <table>\n          <thead>\n            <tr>\n              <th>Filename</th>\n              <th>Size</th>\n              <th>Last Modified</th>\n            </tr>\n          </thead>\n          <tbody>\n            {backupFiles.map((backupFile) => (\n              <tr key={backupFile.id}>\n                <td>\n                  <NavLink to={`file/${backupFile.path}`}>{backupFile.path}</NavLink>\n                </td>\n                <td>{humanSize(backupFile.size)}</td>\n                <td>{new Date(backupFile.modified).toLocaleString()}</td>\n                <td></td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n\n        <Outlet />\n      </div>\n    );\n  } else {\n    return null;\n  }\n}\n"],"names":["backupId","useParams","db","useDb","backup","setBackup","useState","backupFiles","setBackupFiles","useEffect","get","parseInt","then","backupFileIds","files","map","file","id","getAllFromIndex","IDBKeyRange","bound","Math","min","max","filter","backupFile","indexOf","_jsx","cx","name","_jsxs","path","humanSize","size","Date","modified","toLocaleString"],"mappings":"gGAOiC,YAAA,CACzB,KAAA,CAAEA,YAAaC,EAArB,EACMC,EAAKC,IAEL,CAACC,EAAQC,GAAaC,EAA5B,QAAA,SAAA,EACM,CAACC,EAAaC,GAAkBF,EAAAA,QAAAA,SAAgC,CAAxB,CAAA,EAgC9C,MA9BAG,GAAAA,QAAAA,UACE,UAAY,CACV,AAAI,CAACT,GAEFU,EAAAA,IAAI,SAAUC,SAASX,CAAD,CAAzB,EAAqCY,KAAMR,AAAAA,GAAWC,EAAUD,CAAhE,CAAA,CAAA,EAEF,CAACJ,EAAUE,CAAX,CANO,EASTO,EAAAA,QAAAA,UACE,UAAY,CACV,GAAI,CAACL,EAAQ,OAEb,KAAMS,GAAgBT,EAAOU,MAAMC,IAAKC,AAAAA,GAASA,EAAKC,EAAhC,EAEnBC,EAAAA,gBACD,aACA,QACAC,YAAYC,MAAMC,KAAKC,IAAI,GAAGT,CAAZ,EAA4BQ,KAAKE,IAAI,GAAGV,CAAZ,CAA9C,CAHF,EAIED,KAAME,AACNN,GAAAA,EACEM,EAAMU,OACHC,AAAerB,GAAAA,EAAOU,MAAMC,IAAI,CAAC,CAAEE,QAASA,CAA7B,EAAiCS,QAAQD,EAAWR,EAApD,IAAsE,EADxF,CANJ,CAAA,CAAA,EAYF,CAACb,EAAQF,CAAT,CAlBO,EAqBLE,IAEA,MAAA,CAAA,SACE,CAAAuB,EAAA,KAAA,CAAI,UAAWC,EAAG,UAAW,aAAZ,EAAjB,WACE,KAAA,CAAA,SACE,CAAAD,EAAA,KAAA,CAAA,WACG,EAAD,CAAS,GAAG,qBAAqB,UAAWC,EAAG,gBAAiB,oBAAlB,EAA9C,SAAA,SAAA,CAAA,CAAA,CADF,EAKAD,EAAA,KAAA,CAAA,SAAKvB,EAAOyB,IAAAA,CANd,CAAA,CAAA,CAAA,CAAA,CADF,EAWAC,EAAA,QAAA,CAAA,SACE,CAAAH,EAAA,QAAA,CAAA,WACE,KAAA,CAAA,SACE,CAAAA,EAAA,KAAA,CAAA,SAAA,UAAA,CAAA,EACAA,EAAA,KAAA,CAAA,SAAA,MAAA,CAAA,EACAA,EAAA,KAAA,CAAA,SAAA,eAAA,CAHF,CAAA,CAAA,CAAA,CAAA,CADF,EAOAA,EAAA,QAAA,CAAA,SACGpB,EAAYQ,IAAKU,AAAAA,KAChB,KAAA,CAAA,SACE,CAAAE,EAAA,KAAA,CAAA,WACG,EAAD,CAAS,GAAK,QAAOF,EAAWM,OAAhC,SAAyCN,EAAWM,IAAAA,CAApD,CAAA,CADF,EAGAJ,EAAA,KAAA,CAAA,SAAKK,EAAUP,EAAWQ,IAAZ,CAAA,CAAd,EACAN,EAAA,KAAA,CAAA,SAAK,GAAIO,MAAKT,EAAWU,QAApB,EAA8BC,eAA9B,CAAL,CAAA,EACAT,EANF,KAAA,CAAA,CAAA,CAAA,CAAA,EAASF,EAAWR,EAApB,CADD,CAAA,CATL,CAAA,CAZF,CAAA,EAkCEU,EAAC,EAlCH,CAAA,CAAA,CAAA,CAAA,CADF,EAuCO,IAEV"}