import{i as ae,m as O,t as T,e as ue,a as te,b as G,c as j,C as pe,d as ce,D as me,f as fe,g as k,h as he,j as Y,k as ve,l as ge,n as ye,o as de,p as xe,q as ke,r as b,G as Ae,s as H,u as be,v as Z,w as z,P as K,x as De,y as Me,z as Se,A as we,B as Ie,E as Ne,S as R,F as Ee,H as D,I as Te,J as re,K as W,L as X,_ as Ce,M as Fe,N as $e,O as Ve,Q as Ge,R as Pe,T as Oe,U as Le,V as _e,W as Be,X as je,Y as Ye,Z as He,$ as Ze,a0 as ze,a1 as Ke}from"./colors.5d30cfbf.js";import{r as d,s as Re,p as We,j as x,a as v,t as A}from"./index.cdc0d17d.js";import"./_commonjsHelpers.4e997714.js";function Xe(t,e){if(!t)return!1;for(var a=ae(t)?t:[t],n=0;n<a.length;n++)if(a[n]&&a[n][e])return!0;return!1}function M(t){fe(t,"label",["show"])}var S=O(),ne=function(t){T.exports.__extends(e,t);function e(){var a=t!==null&&t.apply(this,arguments)||this;return a.type=e.type,a.createdBySelf=!1,a}return e.prototype.init=function(a,n,r){this.mergeDefaultAndTheme(a,r),this._mergeOption(a,r,!1,!0)},e.prototype.isAnimationEnabled=function(){if(ue.node)return!1;var a=this.__hostSeries;return this.getShallow("animation")&&a&&a.isAnimationEnabled()},e.prototype.mergeOption=function(a,n){this._mergeOption(a,n,!1,!1)},e.prototype._mergeOption=function(a,n,r,s){var l=this.mainType;r||n.eachSeries(function(o){var i=o.get(this.mainType,!0),p=S(o)[l];if(!i||!i.data){S(o)[l]=null;return}p?p._mergeOption(i,n,!0):(s&&M(i),te(i.data,function(u){u instanceof Array?(M(u[0]),M(u[1])):M(u)}),p=this.createMarkerModelFromSeries(i,this,n),G(p,{mainType:this.mainType,seriesIndex:o.seriesIndex,name:o.name,createdBySelf:!0}),p.__hostSeries=o),S(o)[l]=p},this)},e.prototype.formatTooltip=function(a,n,r){var s=this.getData(),l=this.getRawValue(a),o=s.getName(a);return j("section",{header:this.name,blocks:[j("nameValue",{name:o,value:l,noName:!o,noValue:l==null})]})},e.prototype.getData=function(){return this._data},e.prototype.setData=function(a){this._data=a},e.getMarkerModelFromSeries=function(a,n){return S(a)[n]},e.type="marker",e.dependencies=["series","grid","polar","geo"],e}(pe);ce(ne,me.prototype);var N=ne;function P(t){return!(isNaN(parseFloat(t.x))&&isNaN(parseFloat(t.y)))}function qe(t){return!isNaN(parseFloat(t.x))&&!isNaN(parseFloat(t.y))}function w(t,e,a,n,r,s){var l=[],o=ve(e,n),i=o?e.getCalculationInfo("stackResultDimension"):n,p=ie(e,i,t),u=e.indicesOfNearest(i,p)[0];l[r]=e.get(a,u),l[s]=e.get(i,u);var m=e.get(n,u),c=ge(e.get(n,u));return c=Math.min(c,20),c>=0&&(l[s]=+l[s].toFixed(c)),[l,m]}var $={min:k(w,"min"),max:k(w,"max"),average:k(w,"average"),median:k(w,"median")};function q(t,e){var a=t.getData(),n=t.coordinateSystem;if(e&&!qe(e)&&!ae(e.coord)&&n){var r=n.dimensions,s=Je(e,a,n,t);if(e=he(e),e.type&&$[e.type]&&s.baseAxis&&s.valueAxis){var l=Y(r,s.baseAxis.dim),o=Y(r,s.valueAxis.dim),i=$[e.type](a,s.baseDataDim,s.valueDataDim,l,o);e.coord=i[0],e.value=i[1]}else{for(var p=[e.xAxis!=null?e.xAxis:e.radiusAxis,e.yAxis!=null?e.yAxis:e.angleAxis],u=0;u<2;u++)$[p[u]]&&(p[u]=ie(a,a.mapDimension(r[u]),p[u]));e.coord=p}}return e}function Je(t,e,a,n){var r={};return t.valueIndex!=null||t.valueDim!=null?(r.valueDataDim=t.valueIndex!=null?e.getDimension(t.valueIndex):t.valueDim,r.valueAxis=a.getAxis(Qe(n,r.valueDataDim)),r.baseAxis=a.getOtherAxis(r.valueAxis),r.baseDataDim=e.mapDimension(r.baseAxis.dim)):(r.baseAxis=n.getBaseAxis(),r.valueAxis=a.getOtherAxis(r.baseAxis),r.baseDataDim=e.mapDimension(r.baseAxis.dim),r.valueDataDim=e.mapDimension(r.valueAxis.dim)),r}function Qe(t,e){var a=t.getData().getDimensionInfo(e);return a&&a.coordDim}function J(t,e){return t&&t.containData&&e.coord&&!P(e)?t.containData(e.coord):!0}function Ue(t,e,a){return t&&t.containZone&&e.coord&&a.coord&&!P(e)&&!P(a)?t.containZone(e.coord,a.coord):!0}function ie(t,e,a){if(a==="average"){var n=0,r=0;return t.each(e,function(s,l){isNaN(s)||(n+=s,r++)}),n/r}else return a==="median"?t.getMedian(e):t.getDataExtent(e)[a==="max"?1:0]}var V=O(),ea=function(t){T.exports.__extends(e,t);function e(){var a=t!==null&&t.apply(this,arguments)||this;return a.type=e.type,a}return e.prototype.init=function(){this.markerGroupMap=ye()},e.prototype.render=function(a,n,r){var s=this,l=this.markerGroupMap;l.each(function(o){V(o).keep=!1}),n.eachSeries(function(o){var i=N.getMarkerModelFromSeries(o,s.type);i&&s.renderSeries(o,i,n,r)}),l.each(function(o){!V(o).keep&&s.group.remove(o.group)})},e.prototype.markKeep=function(a){V(a).keep=!0},e.prototype.toggleBlurSeries=function(a,n){var r=this;te(a,function(s){var l=N.getMarkerModelFromSeries(s,r.type);if(l){var o=l.getData();o.eachItemGraphicEl(function(i){i&&(n?de(i):xe(i))})}})},e.type="marker",e}(ke),aa=ea,ta=function(t){T.exports.__extends(e,t);function e(){var a=t!==null&&t.apply(this,arguments)||this;return a.type=e.type,a}return e.prototype.createMarkerModelFromSeries=function(a,n,r){return new e(a,n,r)},e.type="markArea",e.defaultOption={z:1,tooltip:{trigger:"item"},animation:!1,label:{show:!0,position:"top"},itemStyle:{borderWidth:0},emphasis:{label:{show:!0,position:"top"}}},e}(N),ra=ta,I=O(),na=function(t,e,a,n){var r=q(t,n[0]),s=q(t,n[1]),l=r.coord,o=s.coord;l[0]=D(l[0],-1/0),l[1]=D(l[1],-1/0),o[0]=D(o[0],1/0),o[1]=D(o[1],1/0);var i=Te([{},r,s]);return i.coord=[r.coord,s.coord],i.x0=r.x,i.y0=r.y,i.x1=s.x,i.y1=s.y,i};function E(t){return!isNaN(t)&&!isFinite(t)}function Q(t,e,a,n){var r=1-t;return E(e[r])&&E(a[r])}function ia(t,e){var a=e.coord[0],n=e.coord[1],r={coord:a,x:e.x0,y:e.y0},s={coord:n,x:e.x1,y:e.y1};return re(t,"cartesian2d")?a&&n&&(Q(1,a,n)||Q(0,a,n))?!0:Ue(t,r,s):J(t,r)||J(t,s)}function U(t,e,a,n,r){var s=n.coordinateSystem,l=t.getItemModel(e),o,i=W(l.get(a[0]),r.getWidth()),p=W(l.get(a[1]),r.getHeight());if(!isNaN(i)&&!isNaN(p))o=[i,p];else{if(n.getMarkerPosition)o=n.getMarkerPosition(t.getValues(a,e));else{var u=t.get(a[0],e),m=t.get(a[1],e),c=[u,m];s.clampData&&s.clampData(c,c),o=s.dataToPoint(c,!0)}if(re(s,"cartesian2d")){var h=s.getAxis("x"),f=s.getAxis("y"),u=t.get(a[0],e),m=t.get(a[1],e);E(u)?o[0]=h.toGlobalCoord(h.getExtent()[a[0]==="x0"?0:1]):E(m)&&(o[1]=f.toGlobalCoord(f.getExtent()[a[1]==="y0"?0:1]))}isNaN(i)||(o[0]=i),isNaN(p)||(o[1]=p)}return o}var ee=[["x0","y0"],["x1","y0"],["x1","y1"],["x0","y1"]],oa=function(t){T.exports.__extends(e,t);function e(){var a=t!==null&&t.apply(this,arguments)||this;return a.type=e.type,a}return e.prototype.updateTransform=function(a,n,r){n.eachSeries(function(s){var l=N.getMarkerModelFromSeries(s,"markArea");if(l){var o=l.getData();o.each(function(i){var p=b(ee,function(m){return U(o,i,m,s,r)});o.setItemLayout(i,p);var u=o.getItemGraphicEl(i);u.setShape("points",p)})}},this)},e.prototype.renderSeries=function(a,n,r,s){var l=a.coordinateSystem,o=a.id,i=a.getData(),p=this.markerGroupMap,u=p.get(o)||p.set(o,{group:new Ae});this.group.add(u.group),this.markKeep(u);var m=sa(l,a,n);n.setData(m),m.each(function(c){var h=b(ee,function(le){return U(m,c,le,a,s)}),f=l.getAxis("x").scale,g=l.getAxis("y").scale,L=f.getExtent(),_=g.getExtent(),C=[f.parse(m.get("x0",c)),f.parse(m.get("x1",c))],F=[g.parse(m.get("y0",c)),g.parse(m.get("y1",c))];H(C),H(F);var oe=!(L[0]>C[1]||L[1]<C[0]||_[0]>F[1]||_[1]<F[0]),se=!oe;m.setItemLayout(c,{points:h,allClipped:se});var y=m.getItemModel(c).getModel("itemStyle").getItemStyle(),B=be(i,"color");y.fill||(y.fill=B,Z(y.fill)&&(y.fill=z(y.fill,.4))),y.stroke||(y.stroke=B),m.setItemVisual(c,"style",y)}),m.diff(I(u).data).add(function(c){var h=m.getItemLayout(c);if(!h.allClipped){var f=new K({shape:{points:h.points}});m.setItemGraphicEl(c,f),u.group.add(f)}}).update(function(c,h){var f=I(u).data.getItemGraphicEl(h),g=m.getItemLayout(c);g.allClipped?f&&u.group.remove(f):(f?De(f,{shape:{points:g.points}},n,c):f=new K({shape:{points:g.points}}),m.setItemGraphicEl(c,f),u.group.add(f))}).remove(function(c){var h=I(u).data.getItemGraphicEl(c);u.group.remove(h)}).execute(),m.eachItemGraphicEl(function(c,h){var f=m.getItemModel(h),g=m.getItemVisual(h,"style");c.useStyle(m.getItemVisual(h,"style")),Me(c,Se(f),{labelFetcher:n,labelDataIndex:h,defaultText:m.getName(h)||"",inheritColor:Z(g.fill)?z(g.fill,1):"#000"}),we(c,f),Ie(c,null,null,f.get(["emphasis","disabled"])),Ne(c).dataModel=n}),I(u).data=m,u.group.silent=n.get("silent")||a.get("silent")},e.type="markArea",e}(aa);function sa(t,e,a){var n,r,s=["x0","y0","x1","y1"];if(t){var l=b(t&&t.dimensions,function(p){var u=e.getData(),m=u.getDimensionInfo(u.mapDimension(p))||{};return G(G({},m),{name:p,ordinalMeta:null})});r=b(s,function(p,u){return{name:p,type:l[u%2].type}}),n=new R(r,a)}else r=[{name:"value",type:"float"}],n=new R(r,a);var o=b(a.get("data"),k(na,e,t,a));t&&(o=Ee(o,k(ia,t)));var i=t?function(p,u,m,c){var h=p.coord[Math.floor(c/2)][c%2];return X(h,r[c])}:function(p,u,m,c){return X(p.value,r[c])};return n.initData(o,null,i),n.hasItemOption=!0,n}var la=oa;function ua(t){t.registerComponentModel(ra),t.registerComponentView(la),t.registerPreprocessor(function(e){Xe(e.series,"markArea")&&(e.markArea=e.markArea||{})})}Ve([Ge,Pe,Oe,Le,_e,Be,je,Ye,ua,He,Ze,ze,Ke]);async function*pa(t){let e=t[1];for(let a=2;a<t.length;a++){const n=t[a],r=n.time-e.time;for(const[s,l]of Object.entries(n.temps)){if(l===0||e.temps[s]===0)continue;const o=l-e.temps[s];Math.abs(o/r)>10&&(yield[s,[{name:`${s} changed ${o.toFixed(1)}C`,xAxis:a-1},{xAxis:a}]])}e=n}}function ha({klippyLog:{stats:t}}){const e=d.exports.useRef(null),[a,n]=d.exports.useState(null),[r,s]=d.exports.useState(null),l=d.exports.useMemo(()=>Re(t),[t]),o=d.exports.useMemo(()=>Object.keys(l[0].temps),[l]);return d.exports.useEffect(()=>{(async function(){console.time("calc chartData");const i={time:new Array(l.length),legend:o,series:o.map(p=>({name:p,type:"line",data:new Array(l.length)}))};for(let p=0;p<l.length;p++)o.forEach((u,m)=>{!l[p].temps[u]||(i.series[m].data[p]=[l[p].time,l[p].temps[u]])});console.timeEnd("calc chartData"),n(i)})()},[l,o]),d.exports.useEffect(()=>{(async function(){for await(const[i,p]of pa(l))s(We(u=>{if(!u)return{[i]:[p]};u[i]||(u[i]=[]),u[i].push(p)}))})()},[l,s]),x("section",{children:[v("h3",{className:A("text-xl"),children:"Temperatures over time"}),a?v(Ce,{echarts:Fe,ref:e,style:{height:r?"600px":"500px"},option:{darkMode:!0,textStyle:{color:"rgb(229, 231, 235)"},toolbox:{feature:{dataZoom:{yAxisIndex:"none"},saveAsImage:{}}},tooltip:{trigger:"axis"},dataZoom:[{type:"slider"},{type:"inside"}],legend:{textStyle:{color:"rgb(229, 231, 235)"},data:a.legend},grid:{top:r?180:80,bottom:100},xAxis:{type:"category",axisLabel:{formatter(i){return new Date(parseFloat(i)*1e3).toLocaleTimeString()}}},yAxis:{type:"value"},series:a.series.map(i=>({...i,...r&&i.name in r?{markArea:{itemStyle:{color:$e.red[500]},label:{offset:[-20,15],rotate:-60},data:r[i.name]}}:{}}))}}):v("div",{children:"Loading..."}),r&&a?x("div",{className:A("mt-2"),children:[v("h3",{className:A("text-xl","text-red-400"),children:"Problems were identified"}),x("article",{children:[v("p",{children:"Large jumps in temperature are often indicative of a broken wire, or a thermometer that is not working properly."}),"extruder"in r&&v("p",{})]}),v("table",{className:A("table","table-zebra","table-compact","w-full"),children:Object.entries(r).map(([i,p])=>x(d.exports.Fragment,{children:[v("thead",{children:v("tr",{children:v("th",{className:A("text-lg"),colSpan:2,children:i})})}),x("tbody",{children:[v("tr",{children:v("td",{colSpan:2,children:i==="extruder"?`
                        Your extruder is showing spikes in temperature. There is probably a loose crimp, or a broken
                        wire in your cable chains.
                        `:i==="bed"?`
                        Your bed is showing spikes in temperature. If you have a moving bed, you probably have a loose
                        crimp or a broken wire. If your bed is static, you have more serious problems.
                        `:`
                        Your thermometer ${i} is showing spikes in temperature. If this thermometer moves, such 
                        as a chamber thermistor on a toolhead PCB, you most likely have a bad crimp or broken wire in 
                        your cable chain.

                        If this is a static thermistor, you should check all wiring, crimps, and then verify other 
                        thermistors are working properly. Thermistors can rarely break, although it is also possible
                        your control board has a problem. Bad wiring causing voltage to leak to ground is also a
                        possibility.
                        `})}),p.map(([u])=>x("tr",{children:[v("td",{children:new Date(u.xAxis*1e3).toLocaleTimeString()}),v("td",{children:u.name})]},u.xAxis))]})]},i))})]}):null]})}export{ha as default};
