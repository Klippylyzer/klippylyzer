import{u as g,r as o,e as N,j as l,a as e,t as a,F as u,T as _,f as b,g as y,h as f,i as v}from"./index.42fbafd1.js";var t=(r=>(r.Completed="completed",r.Cancelled="cancelled",r.Error="error",r.Printing="printing",r.InProgress="in_progress",r.Server_Exit="server_exit",r.Klippy_Shutdown="klippy_shutdown",r.Klippy_Disconnect="klippy_disconnect",r))(t||{});function m({length:r}){return e("span",{children:r>1e5?`${(r/1e5).toFixed(1)} km`:r>100?`${(r/1e3).toFixed(1)} m`:r>10?`${(r/10).toFixed(1)}cm`:`${r.toFixed(1)}mm`})}function c({duration:r}){return e("span",{children:r>3600*48?`${(r/(3600*24)).toFixed(1)} days`:r>3600?`${(r/3600).toFixed(1)} h`:r>60?`${(r/60).toFixed(1)} min`:`${r.toFixed(1)}s`})}function k(){const{rpc:r}=g(),[p,n]=o.exports.useState([]),[i,h]=o.exports.useState(null);return o.exports.useEffect(()=>{!r||(r.call("server.history.totals").then(({job_totals:s})=>{h(s)}),r.call("server.history.list").then(({count:s,jobs:d})=>{n(d),console.log(s,d.length)}))},[r,n,h]),N(r,"notify_history_changed",([{action:s,job:d}])=>{console.log(s,d),n(v(x=>{x.unshift(d)}))}),l("section",{children:[e("h2",{className:a("text-xl"),children:"History"}),e("article",{className:a("flex","flex-row"),children:i&&l(u,{children:[e("div",{className:a("card","bg-base-100","dark:bg-base-300","shadow-xl","mr-1"),children:l("div",{className:a("card-body"),children:[e("h2",{className:a("card-title"),children:"Longest Job"}),e(c,{duration:i.longest_job})]})}),e("div",{className:a("card","bg-base-100","dark:bg-base-300","shadow-xl","mr-1"),children:l("div",{className:a("card-body"),children:[e("h2",{className:a("card-title"),children:"Longest Print"}),e(c,{duration:i.longest_print})]})}),e("div",{className:a("card","bg-base-100","dark:bg-base-300","shadow-xl","mr-1"),children:l("div",{className:a("card-body"),children:[e("h2",{className:a("card-title"),children:"Filament Used"}),e(m,{length:i.total_filament_used})]})}),e("div",{className:a("card","bg-base-100","dark:bg-base-300","shadow-xl","mr-1"),children:l("div",{className:a("card-body"),children:[e("h2",{className:a("card-title"),children:"Total Jobs"}),i.total_jobs]})}),e("div",{className:a("card","bg-base-100","dark:bg-base-300","shadow-xl","mr-1"),children:l("div",{className:a("card-body"),children:[e("h2",{className:a("card-title"),children:"Print Time"}),e(c,{duration:i.total_print_time})]})}),e("div",{className:a("card","bg-base-100","dark:bg-base-300","shadow-xl","mr-1"),children:l("div",{className:a("card-body"),children:[e("h2",{className:a("card-title"),children:"Total Time"}),e(c,{duration:i.total_time})]})})]})}),l("table",{className:a("table","table-compact","text-sm"),children:[e("thead",{children:l("tr",{children:[e("th",{children:"Filename"}),e("th",{children:"Start"}),e("th",{children:"Status"}),e("th",{children:"Total Time"}),e("th",{children:"Print Time"}),e("th",{children:"Filament Used"})]})}),e("tbody",{className:a("text-sm"),children:p.map(s=>l("tr",{children:[e("td",{className:a("line-clamp-1"),children:s.filename}),e("td",{children:new Date(s.start_time*1e3).toLocaleString()}),e("td",{title:s.status,children:(()=>{switch(s.status){case t.Printing:case t.InProgress:return e(f,{size:"1.5rem",className:a("fill-primary","-m-0.5")});case t.Completed:return e(y,{size:"1.5rem",className:a("fill-success","-m-0.5")});case t.Cancelled:return e(b,{size:"1.5rem",className:a("fill-info","-m-0.5")});case t.Error:case t.Server_Exit:case t.Klippy_Shutdown:case t.Klippy_Disconnect:return e(_,{size:"1.5rem",className:a("fill-error","-m-0.5")})}})()}),e("td",{children:e(c,{duration:s.total_duration})}),e("td",{children:e(c,{duration:s.print_duration})}),e("td",{children:e(m,{length:s.filament_used})})]},s.job_id))})]})]})}export{k as default};
//# sourceMappingURL=History.7aca079c.js.map
